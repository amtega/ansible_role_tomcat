---
# Role variables

# Supported distributions

tomcat_supported_distributions:
  - centos
  - fedora
  - rhel

# Supported distributions versions

tomcat_supported_versions:
  centos: 6
  fedora: 26
  rhel: 7

# Required operating system packages

tomcat_packages:
  centos_6:
    - gcc
    - libxml2-devel
    - libxml2-python
    - libxslt-devel
    - libxslt-python
    - python-devel
    - python-pip
    - rsync
    - tar
  centos_7:
    - python-lxml
    - rsync
    - tar
  fedora_26:
    - python-lxml
    - rsync
    - tar
  fedora_27:
    - python-lxml
    - rsync
    - tar
  rhel_6:
    - python-lxml
    - rsync
    - tar
  rhel_7:
    - python-lxml
    - rsync
    - tar

# Required python pip packages

tomcat_packages_python:
  centos_6:
    - lxml

# Major, minor and patch version numbers

tomcat_version_major: >-
  {{ tomcat_version | regex_replace("([0-9]+)\.([0-9]+)\.([0-9]+)", "\1") }}
tomcat_version_minor: >-
  {{ tomcat_version | regex_replace("([0-9]+)\.([0-9]+)\.([0-9]+)", "\2") }}
tomcat_version_patch: >-
  {{ tomcat_version | regex_replace("([0-9]+)\.([0-9]+)\.([0-9]+)", "\3") }}

# Download variables

tomcat_default_download_dist_url: >-
  {{ tomcat_download_mirror
     ~ "/dist/tomcat"
     ~ "/tomcat-"
     ~ tomcat_version_major
     ~ "/v"
     ~ tomcat_version
     ~ "/bin/" }}

tomcat_default_download_tarball: >-
  {{ "apache-tomcat-"
     ~ tomcat_version
     ~ ".tar.gz" }}

tomcat_default_download_url: >-
  {{ tomcat_default_download_dist_url }}/{{ tomcat_default_download_tarball }}

tomcat_download_tarball: >-
  {{ tomcat_download_url
     | default(tomcat_default_download_url)
     | urlsplit('path')
     | basename }}

tomcat_download_tarball_version: >-
  {{ tomcat_download_tarball
     | regex_replace("apache-tomcat-([0-9]+\.[0-9]+\.[0-9]+)\.tar\.gz", "\1") }}

# Tomcat home directory

tomcat_home: >-
  {{ tomcat_install_path }}/{{ tomcat_download_tarball
                            | regex_replace("(.*)\.tar\.gz", "\1") }}

# Permissions to use in tomcat directories and files

tomcat_files_permissions: "u=rwx,go=rx"

# Proxy environment settings

tomcat_http_proxy_config:
    http_proxy: "{{ tomcat_http_proxy | default('') }}"
    https_proxy: "{{ tomcat_https_proxy | default('') }}"
    http_no_proxy: "{{ tomcat_http_no_proxy | default('') }}"

tomcat_http_proxy_environment: >-
  {{ (tomcat_http_proxy is defined
      or tomcat_https_proxy is defined
      or tomcat_http_no_proxy is defined)
     | ternary(tomcat_http_proxy_config, {}) }}

# Tomcat server.xml xpath variables

tomcat_xpath_connector: "/Server/Service[@name='Catalina']/Connector"
