{{ ansible_managed | comment }}

{% set java_variables=instance.java_variables | default(tomcat_instance_java_variables) %}
{% set java_min_heap_size=instance.java_min_heap_size | default(tomcat_instance_java_min_heap_size) %}
{% set java_max_heap_size=instance.java_max_heap_size | default(tomcat_instance_java_max_heap_size) %}
{% set java_min_perm_size=instance.java_min_perm_size | default(tomcat_instance_java_min_perm_size) %}
{% set java_max_perm_size=instance.java_max_perm_size | default(tomcat_instance_java_max_perm_size) %}
{% set java_options=namespace(strings=[]) %}

{% if java_min_heap_size | length > 0 %}{% set java_options.strings=java_options.strings + [ "-Xms" + java_min_heap_size ] %}{% endif %}
{% if java_max_heap_size | length > 0 %}{% set java_options.strings=java_options.strings + [ "-Xmx" + java_max_heap_size ] %}{% endif %}
{% if java_min_perm_size | length > 0 %}{% set java_options.strings=java_options.strings + [ "-XX:PermSize=" + java_min_perm_size ] %}{% endif %}
{% if java_max_perm_size | length > 0 %}{% set java_options.strings=java_options.strings + [ "-XX:MaxPermSize=" + java_max_perm_size ] %}{% endif %}

{% for variable in java_variables %}
{% set java_options.strings=java_options.strings + ["-D" + variable + "=" + java_variables[variable]] %}
{% endfor %}

{% set java_options.strings=java_options.strings + instance.java_raw_opts | default(tomcat_instance_java_raw_opts) %}

JAVA_HOME="{{ instance.java_home | default(tomcat_instance_java_home) }}"
JAVA_OPTS="{{ java_options.strings | join(' ') }}"
CATALINA_HOME="{{ instance_home | default(tomcat_instance_home ) }}"
CATALINA_BASE="{{ instance_base | default(tomcat_instance_base) }}"
CATALINA_PID="{{ instance_base }}/{{ instance.pid_file | default(tomcat_instance_pid_file) }}"
